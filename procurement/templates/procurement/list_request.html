{% extends 'procurement/base.html' %}
{% load humanize %}

{% block header %}

  <li><a class="menu_bt" href="{% url 'procurement:list_all' %}">Topへ戻る</a></li>


{% endblock%}


{% block content %}


<div class="menu_wrapper">

  <div><h3>依頼一覧</h3></div>

  <div class="menu_wrapper_inner">

    <ul class="page_nav">
    <li>
      {% if page_obj.has_previous %}
        <a class="menu_bt menu_bt_mg_left next_bt" href="?page={{ page_obj.previous_page_number }}">＜</a>
      {% else %}
      {% endif %}
    </li>

    <li>
      {% if page_obj.has_next %}
        <a class="menu_bt menu_bt_mg_left next_bt" href="?page={{ page_obj.next_page_number }}">＞</a>
      {% else %}
      {% endif %}
    </li>
    </ul>
  </div>

</div>

<table class="item-table table_request">

	<tr>
		<th class="sticky_col_th first_col">選択</th>
		<th class="sticky_col_th second_col">依頼番号</th>
    <th>依頼日</th>
    <th>進捗</th>
    <th>発注番号</th>
    <th>依頼者</th>
    <th>依頼内容</th>
    <th>希望納期</th>
    <th>納品日</th>
		<th>納品先</th>
    <th>発注先</th>

    <th>発注日</th>
    <th>支払日</th>
    <th>支払完了</th>

		<th>数量</th>
		<th>税込総額</th>
		<th>目的</th>
    <th>標準品</th>
    <th>稟議</th>
    <th>プロジェクト</th>

		<th>精査者</th>
		<th>精査メモ</th>

    <th>発注者</th>
    <th>発注メモ</th>

		<th>検収日</th>
    <th>検収者</th>
  </tr>
  
  {% for item in object_list %}

  <!-- 進捗状況に応じた色の設定 -->
  {% if item.adminCheck.no == 1 %}
  <tr class="row-yellow">
  {%  elif item.adminCheck.no == 2 %}
    <tr class="row-white">
  {%  elif item.adminCheck.no == 0 %}
    <tr class="row-red">
  {%  elif item.adminCheck.no == 4 %}
    <tr class="row-blue">
  {%  elif item.adminCheck.no == 5 %}
    <tr class="row-green">
  {%  elif item.adminCheck.no == 6 %}
    <tr class="row-gray">
  {% endif %}
  <td class="sticky_col_td first_col">
    <input onclick="clickRequest()" type="checkbox" name="selected_request" value="{{ item.pk }}">
  </td>

  <td class="sticky_col_td second_col">
    <a href="{% url 'procurement:detail_request' item.pk %}">
      {{ item.requestNum }}
    </a>
  </td>

  <td class="date_col">{{ item.submissionDate | date:"m/d"}}</td>
  <td>{{ item.adminCheck.name }}</td>
  <td name="orderNumInRequest">
    {% if item.orderInfo %}
      <a href="{% url 'procurement:detail_order'  item.orderInfo.pk %}">
      {{ item.orderInfo.orderNum }}
      </a>
    {% else %}
    {% endif %}
  </td>

  <td>{{ item.requestStaffdb.fullName }}</td>

  <td class="longText">{{ item.requestDetail }}</td>
  <td class="date_col">{{ item.dueDate | date:"m/d"}}</td>
  <td class="date_col">
    {%  if item.orderInfo %}
      {{ item.orderInfo.arrivalDate | date:"m/d" }}
    {%  else %}
      <p>-</p>
    {% endif %}
  </td>
  <td>{{ item.deliveryAddress.name }}</td>

  <td>
    {%  if item.orderInfo %}
      {%  if item.orderInfo.registeredSupplier %}
        {{ item.orderInfo.registeredSupplier.name }}
      {%  else %}
        {{ item.orderInfo.irregularSupplier }}
      {% endif %}
    {% endif %}
  </td>

  <td class="date_col">
    {%  if item.orderInfo %}
      {{ item.orderInfo.orderDate | date:"m/d" }}
    {%  else %}
      <p>-</p>
    {% endif %}
  </td>

  <td class="date_col">
    {%  if item.orderInfo.paymentMethod.no == 1 and item.orderInfo.irregularSupplier %}
    {{ item.orderInfo.settlementDate | date:"m/d" }}
    {%  else %}
    <p>-</p>
    {% endif %}
  </td>

  <td class="date_col">
    {%  if item.orderInfo.paymentMethod.no == 1 and item.orderInfo.irregularSupplier %}

      {%  if item.orderInfo.settlement == True %}
      <p>&check;</p>
      {%  else %}
      <p>未</p>
      {% endif %}

    {%  else %}
    <p>-</p>
    {% endif %}
  </td>



  <td>{{ item.quantity }}</td>
  <td class="number_col" name="selected_request_amount">{{ item.estimatedAmount|intcomma }}</td>

  <td>{{ item.purpose.name }}</td>
  <td class="date_col">
    {% if item.standardItem == True %}
      <p>&check;</p>
    {% else %}
    {% endif %}
  </td>

  <td>{% if item.approval %}
        {{ item.approval }}
      {%  else %}
      {% endif %}  
  </td>
  <td>{% if item.project %}
        {{ item.project }}
      {%  else %}
      {% endif %}  
  </td>

  <td>
    {%  if item.adminStaffdb %}
      {{ item.adminStaffdb.fullName }}
    {%  else %}
    {% endif %}  
  </td>

  <td class="longText">
    {%  if item.adminDescription %}
      {{ item.adminDescription }}
    {%  else %}
    {% endif %} 
  </td>
  
  
  <td>
    {%  if item.orderInfo %}
      {{ item.orderInfo.orderStaffdb.fullName }}
    {%  else %}
      <p>-</p>
    {% endif %}
  </td>

  <td class="longText">
    {%  if item.orderInfo %}
      {{ item.orderInfo.orderDescription }}
    {%  else %}
      <p>-</p>
    {% endif %}
  </td>


  <td class="date_col">
    {%  if item.orderInfo %}
      {{ item.orderInfo.acceptanceDate | date:"m/d" }}
    {%  else %}
      <p>-</p>
    {% endif %}
  </td>

  <td class="date_col">
    {%  if item.orderInfo %}
      {{ item.orderInfo.acceptanceStaffdb.fullName }}
    {%  else %}
      <p>-</p>
    {% endif %}
  </td>
      
</tr>

  {% endfor %}
  
</table>



{% endblock content%}


